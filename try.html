<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Load-Limit PoC</title>
    <style>
        :root {
            --bg-color: #000000;
            --accent-safe: #00ff88;
            --accent-warning: #ffcc00;
            --accent-danger: #ff3333;
            --text-color: #ffffff;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
        }

        #gauge-container {
            text-align: center;
            z-index: 2;
        }

        .label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.6;
            margin-bottom: 5px;
        }

        .value {
            font-size: 5rem;
            font-weight: 800;
            line-height: 1;
        }

        .unit {
            font-size: 1.5rem;
            margin-left: 5px;
            opacity: 0.8;
        }

        #viz {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        #start-btn {
            padding: 15px 40px;
            background: var(--text-color);
            color: black;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(255,255,255,0.1);
        }

        .status-bar {
            position: fixed;
            bottom: 40px;
            text-align: center;
            width: 100%;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="start-screen">
        <button id="start-btn">ENABLE SENSORS</button>
    </div>

    <div id="app-ui" class="hidden">
        <svg id="viz" viewBox="0 0 100 100">
            <line x1="50" y1="10" x2="50" y2="90" stroke="white" stroke-width="0.2" stroke-dasharray="2,2" opacity="0.3" />
            <line id="sling-line" x1="50" y1="50" x2="50" y2="10" stroke="#00ff88" stroke-width="2" stroke-linecap="round" />
        </svg>

        <div id="gauge-container">
            <div class="label">Angle from Vertical</div>
            <div id="angle-display" class="value">0<span class="unit">°</span></div>
            
            <div class="label" style="margin-top: 40px;">Calculated Tension</div>
            <div id="tension-display" class="value">0<span class="unit">kg</span></div>
        </div>

        <div class="status-bar">
            <div id="safety-text" style="font-weight: bold; letter-spacing: 1px;">SYSTEM READY</div>
            <div style="font-size: 0.7rem; opacity: 0.5; margin-top: 5px;">LOAD: 1000kg | SWL: 2000kg</div>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const startScreen = document.getElementById('start-screen');
        const appUi = document.getElementById('app-ui');
        const angleDisplay = document.getElementById('angle-display');
        const tensionDisplay = document.getElementById('tension-display');
        const safetyText = document.getElementById('safety-text');
        const slingLine = document.getElementById('sling-line');

        // Constants for PoC
        const STATIC_LOAD = 1000; // 1000kg base load
        const SWL = 2000;        // 2000kg Safe Working Load

        startBtn.addEventListener('click', () => {
            // Android Chrome request
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') initApp();
                    })
                    .catch(console.error);
            } else {
                initApp();
            }
        });

        function initApp() {
            startScreen.classList.add('hidden');
            appUi.classList.remove('hidden');
            window.addEventListener('deviceorientation', handleMotion);
        }

        function handleMotion(event) {
            // Beta is the front-to-back tilt in degrees
            let angle = Math.abs(event.beta);
            if (angle > 90) angle = 90; // Clamp for PoC

            // Calculate Tension: T = (L/2) / cos(angle)
            // Note: Rigging math usually uses angle from horizontal, 
            // but we use vertical for the phone tilt.
            let rad = angle * (Math.PI / 180);
            let tension = (STATIC_LOAD / 2) / Math.cos(rad);
            
            updateUI(angle, Math.round(tension));
        }

        function updateUI(angle, tension) {
            angleDisplay.innerHTML = `${Math.round(angle)}<span class="unit">°</span>`;
            tensionDisplay.innerHTML = `${tension}<span class="unit">kg</span>`;

            // Rotate visual line
            slingLine.setAttribute('transform', `rotate(${angle}, 50, 50)`);

            // Safety Logic & Haptics
            if (tension > SWL * 0.85) {
                // Danger Zone
                document.body.style.backgroundColor = "#440000";
                safetyText.innerText = "CRITICAL LOAD";
                safetyText.style.color = "var(--accent-danger)";
                slingLine.setAttribute('stroke', "var(--accent-danger)");
                // Vibe-Check
                if (navigator.vibrate) navigator.vibrate(200);
            } else if (tension > SWL * 0.6) {
                // Warning Zone
                document.body.style.backgroundColor = "#332200";
                safetyText.innerText = "WARNING: HIGH TENSION";
                safetyText.style.color = "var(--accent-warning)";
                slingLine.setAttribute('stroke', "var(--accent-warning)");
            } else {
                // Safe Zone
                document.body.style.backgroundColor = "#000000";
                safetyText.innerText = "SAFE TO HANG";
                safetyText.style.color = "var(--accent-safe)";
                slingLine.setAttribute('stroke', "var(--accent-safe)");
            }
        }
    </script>
</body>
</html>
