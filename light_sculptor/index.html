<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Light Sculptor</title>
  <style>
    :root { --light-color: rgb(255, 255, 255); --softness: 0%; --split: 50%; }
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; touch-action: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

    /* The Main Canvas */
    #canvas {
      width: 100%; height: 100%;
      background: linear-gradient(to right, #000 calc(var(--split) - var(--softness)), var(--light-color) calc(var(--split) + var(--softness)));
    }

    /* Hidden Professional Menu */
    #menu {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); display: none; flex-direction: column;
      justify-content: center; align-items: center; color: white; backdrop-filter: blur(10px);
    }

    .menu-row { margin: 20px; text-align: center; }
    .btn-group { display: flex; gap: 10px; margin-top: 10px; }
    button {
      background: #333; border: 1px solid #555; color: white; padding: 12px 20px;
      border-radius: 8px; font-size: 14px; cursor: pointer;
    }
    button.active { background: #fff; color: #000; font-weight: bold; }

    #hint {
      position: absolute; bottom: 20px; width: 100%; text-align: center;
      color: rgba(255,255,255,0.3); font-size: 10px; letter-spacing: 2px; pointer-events: none;
    }
  </style>
</head>
<body>

<div id="canvas"></div>
<div id="hint">LONG PRESS FOR PRO TOOLS</div>

<div id="menu">
  <div class="menu-row">
    <div>COLOR GELS</div>
    <div class="btn-group">
      <button onclick="setMode('white')" id="btn-white" class="active">WHITE</button>
      <button onclick="setMode('red')">RED</button>
      <button onclick="setMode('blue')">BLUE</button>
      <button onclick="setMode('green')">GREEN</button>
    </div>
  </div>
  <div class="menu-row">
    <div>EFFECTS</div>
    <div class="btn-group">
        <button onclick="setEffect('none')" id="fx-none" class="active">STEADY</button>
        <button onclick="setEffect('pulse')" id="fx-pulse">PULSE</button>
        <button onclick="setEffect('strobe')" id="fx-strobe">STROBE</button>
    </div>
    </div>
    <div class="menu-row" id="speed-control" style="display:none;">
        <div id="speed-label">SPEED: 500ms</div>
        <input type="range" min="20" max="2000" value="500" step="10"
               oninput="updateSpeed(this.value)" style="width: 200px; margin-top:10px;">
    </div>
  <button onclick="closeMenu()" style="margin-top: 40px; border: none; background: none; color: #888;">CLOSE</button>
</div>

<script>
  const canvas = document.getElementById('canvas');
  const menu = document.getElementById('menu');
  const hint = document.getElementById('hint');

  let state = {
      split: 50, warmth: 255, softness: 0,
      mode: 'white', isPulsing: false, pulseVal: 1,
      initialPinchDist: 0
  };

  // --- CORE INTERACTION ---
  function updateDisplay() {
    let color;
    if (state.mode === 'white') {
      color = `rgb(255, ${Math.max(180, state.warmth)}, ${state.warmth})`;
    } else if (state.mode === 'red') {
      color = `rgb(${state.warmth}, 0, 0)`;
    } else if (state.mode === 'blue') {
      color = `rgb(0, 0, ${state.warmth})`;
    } else if (state.mode === 'green') {
      color = `rgb(0, ${state.warmth}, 0)`;
    }

    // Apply Pulse
    if (state.isPulsing) {
      canvas.style.opacity = state.pulseVal;
    } else {
      canvas.style.opacity = 1;
    }

    document.documentElement.style.setProperty('--light-color', color);
    document.documentElement.style.setProperty('--split', state.split + '%');
    document.documentElement.style.setProperty('--softness', state.softness + '%');
  }

  // --- GESTURES ---
  let pressTimer;
  const TRIGGER_ZONE = 60;
  window.addEventListener('touchstart', (e) => {

        //menu.style.display = 'flex';
        const touch = e.touches[0];
        const screenWidth = window.innerWidth;

        // Check if the touch is in the top-right corner
        const isTopRight = (touch.clientX > screenWidth - TRIGGER_ZONE) && (touch.clientY < TRIGGER_ZONE);

        if (isTopRight) {
          // Toggle Menu
          const isHidden = menu.style.display === 'none' || menu.style.display === '';
          menu.style.display = isHidden ? 'flex' : 'none';

          // Vibrate for feedback (Requires Capacitor Haptics plugin)
          if (window.Capacitor) {
            // Haptics.impact({ style: 'light' });
          }

          // Prevent the light from shifting when we just wanted the menu
          return;
        }


  });

window.addEventListener('touchmove', (e) => {
  // clearTimeout(pressTimer);
  if (menu.style.display === 'flex') return;
    e.preventDefault();
  const touch = e.touches[0];
  state.split = (touch.clientX / window.innerWidth) * 100;
  state.warmth = (touch.clientY / window.innerHeight) * 255;

  if (e.touches.length === 2) {
    const dX = e.touches[0].clientX - e.touches[1].clientX;
    const dY = e.touches[0].clientY - e.touches[1].clientY;
      const currentDist = Math.sqrt(dX * dX + dY * dY);
      // Calculate change in distance
      const sensitivity = 0.15;
      const delta = (currentDist - state.initialPinchDist) * sensitivity;

      state.softness = Math.max(0, Math.min(45, state.softness + delta));
      state.initialPinchDist = currentDist; // Reset for smooth scaling
  }
  updateDisplay();
  hint.style.opacity = 0;
});

  // window.addEventListener('touchend', () => clearTimeout(pressTimer));

  // --- PRO FEATURES ---
  function setMode(m) {
    state.mode = m;
    document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    updateDisplay();
  }

  let effectInterval = null;
  let currentSpeed = 500; // milliseconds
  let effectMode = 'none'; // 'none', 'pulse', or 'strobe'

  function setEffect(mode) {
      effectMode = mode;

      // UI Update
      document.querySelectorAll('[id^="fx-"]').forEach(b => b.classList.remove('active'));
      document.getElementById(`fx-${mode}`).classList.add('active');

      // Show/Hide speed slider
      document.getElementById('speed-control').style.display = (mode === 'none') ? 'none' : 'block';

      // Clear previous interval
      if (effectInterval) clearInterval(effectInterval);
      canvas.style.opacity = 1; // Reset opacity

      if (mode === 'pulse') {
          runPulse();
      } else if (mode === 'strobe') {
          runStrobe();
      }
  }

  function updateSpeed(val) {
      currentSpeed = val;
      document.getElementById('speed-label').innerText = `SPEED: ${val}ms`;

      // Restart effect to apply new speed immediately
      setEffect(effectMode);
  }

  function runPulse() {
      // Pulse is a soft CSS transition
      canvas.style.transition = `opacity ${currentSpeed}ms ease-in-out`;
      let toggle = false;

      effectInterval = setInterval(() => {
          canvas.style.opacity = toggle ? 1 : 0.1;
          toggle = !toggle;
      }, currentSpeed);
  }

  function runStrobe() {
      // Strobe is a sharp cut (no transition)
      canvas.style.transition = 'none';

      effectInterval = setInterval(() => {
          canvas.style.opacity = 0; // Flash Off
          setTimeout(() => {
              canvas.style.opacity = 1; // Flash On
          }, 10); // 10ms "On" time creates a sharp frozen-motion effect
      }, currentSpeed);
  }

  function closeMenu() { menu.style.display = 'none'; }
</script>
</body>
</html>
